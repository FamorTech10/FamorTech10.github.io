<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mis Tareas</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="color-scheme" content="light" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    html { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; }
  </style>
</head>
<body class="bg-white text-black min-h-screen">
  <header class="sticky top-0 z-20 bg-white border-b border-slate-200">
    <div class="mx-auto max-w-6xl px-4 py-4 flex items-center justify-between">
      <h1 class="text-2xl md:text-3xl font-bold tracking-tight text-black">ðŸ“š Mis Tareas</h1>
    </div>
  </header>

  <main class="mx-auto max-w-3xl px-4 py-8">
    <section class="mb-6">
      <p class="text-black/80"></p>
    </section>

    <section id="taskGrid" class="grid grid-cols-1 gap-6"></section>

    <template id="taskCardTmpl">
      <article class="rounded-lg border border-slate-200 bg-white overflow-hidden" tabindex="0">
        <div class="relative">
          <div class="aspect-[16/10] bg-slate-100 overflow-hidden">
            <img class="w-full h-full object-cover select-none" alt="Imagen de la tarea" loading="lazy" />
          </div>
          <button class="prev absolute inset-y-0 left-0 m-2 size-9 rounded-full grid place-items-center bg-white/80 hover:bg-white border border-slate-200 focus:outline-none" aria-label="Anterior">&#10094;</button>
          <button class="next absolute inset-y-0 right-0 m-2 size-9 rounded-full grid place-items-center bg-white/80 hover:bg-white border border-slate-200 focus:outline-none" aria-label="Siguiente">&#10095;</button>
          <div class="dots absolute bottom-2 inset-x-0 flex justify-center gap-1.5"></div>
        </div>
        <div class="p-4">
          <h2 class="text-lg font-semibold text-black line-clamp-2"></h2>
          <p class="mt-1 text-sm text-black/80 line-clamp-4"></p>
          <a class="task-link inline-flex items-center text-sm underline mt-3 hidden" href="#" target="_blank" rel="noopener">Link al archivo</a>
        </div>
      </article>
    </template>
  </main>

  <script>
    // === Estructura esperada del JSON ===
    // {
    //   "tareas": [
    //     {
    //       "titulo": "Mi tarea de matemÃ¡ticas",
    //       "descripcion": "Resolver ejercicios 1-10 del libro.",
    //       "imagenes": ["/img/tarea1-1.jpg", "/img/tarea1-2.jpg"],
    //       "archivo": "https://mi-dominio.com/mi-tarea.pdf" // opcional (tambiÃ©n se acepta "link")
    //     },
    //     { ... }
    //   ]
    // }

    const grid = document.getElementById('taskGrid');

    (async function init() {
      try {
        const res = await fetch('tareas.json', { cache: 'no-store' });
        if (!res.ok) throw new Error('No se encontrÃ³ tareas.json');
        const data = await res.json();
        renderTasks(sanitizeData(data));
      } catch (err) {
        showError('No se encontrÃ³ el archivo tareas.json.');
      }
    })();

    function sanitizeData(data) {
      const tareas = Array.isArray(data?.tareas) ? data.tareas : [];
      return tareas.map(t => ({
        titulo: String(t.titulo ?? 'Sin tÃ­tulo'),
        descripcion: String(t.descripcion ?? ''),
        imagenes: Array.isArray(t.imagenes) && t.imagenes.length ? t.imagenes.map(String) : [placeholderImg()],
        enlace: (typeof t.archivo === 'string' && t.archivo.trim()) ? t.archivo.trim() : (typeof t.link === 'string' && t.link.trim()) ? t.link.trim() : null
      }));
    }

    function placeholderImg() {
      return 'https://images.unsplash.com/photo-1496307042754-b4aa456c4a2d';
    }

    function showError(msg) {
      grid.innerHTML = `<div class="col-span-full p-4 rounded-lg bg-red-50 text-red-700 border border-red-200">${msg}</div>`;
    }

    function renderTasks(tareas) {
      grid.innerHTML = '';
      if (!tareas.length) {
        showError('No hay tareas para mostrar.');
        return;
      }
      const tmpl = document.getElementById('taskCardTmpl');
      tareas.forEach((tarea) => {
        const node = tmpl.content.cloneNode(true);
        const img = node.querySelector('img');
        const title = node.querySelector('h2');
        const desc = node.querySelector('p');
        const linkEl = node.querySelector('.task-link');
        const prevBtn = node.querySelector('.prev');
        const nextBtn = node.querySelector('.next');
        const dots = node.querySelector('.dots');

        const images = tarea.imagenes;
        let current = 0;

        function updateImage() {
          img.src = images[current];
          img.alt = `${tarea.titulo} â€” imagen ${current + 1} de ${images.length}`;
          renderDots();
        }

        function renderDots() {
          dots.innerHTML = '';
          images.forEach((_, i) => {
            const dot = document.createElement('button');
            dot.className = `size-2.5 rounded-full border border-slate-300 ${i === current ? 'bg-black' : 'bg-white'}`;
            dot.setAttribute('aria-label', `Ir a la imagen ${i + 1}`);
            dot.addEventListener('click', () => { current = i; updateImage(); });
            dots.appendChild(dot);
          });
        }

        prevBtn.addEventListener('click', () => { current = (current - 1 + images.length) % images.length; updateImage(); });
        nextBtn.addEventListener('click', () => { current = (current + 1) % images.length; updateImage(); });

        node.querySelector('article').addEventListener('keydown', (e) => {
          if (e.key === 'ArrowLeft') { prevBtn.click(); }
          if (e.key === 'ArrowRight') { nextBtn.click(); }
        });

        title.textContent = tarea.titulo;
        desc.textContent = tarea.descripcion;
        if (tarea.enlace) {
          linkEl.href = tarea.enlace;
          linkEl.classList.remove('hidden');
        } else {
          linkEl.classList.add('hidden');
        }
        updateImage();
        grid.appendChild(node);
      });
    }
  </script>
</body>
</html>
